<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CATZone - NATCAT Risk Intelligence Platform</title>

```
<!-- External Libraries -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    :root {
        --primary: #1e3c72;
        --secondary: #2a5298;
        --success: #10b981;
        --warning: #f59e0b;
        --danger: #ef4444;
        --dark: #1f2937;
        --light: #f3f4f6;
        --white: #ffffff;
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        min-height: 100vh;
        color: var(--dark);
    }

    .header {
        background: rgba(255,255,255,0.98);
        padding: 1rem 2rem;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
    }

    .nav-menu {
        display: flex;
        gap: 1rem;
        margin-top: 0.5rem;
    }

    .nav-link {
        padding: 0.5rem 1rem;
        background: var(--light);
        color: var(--primary);
        text-decoration: none;
        border-radius: 6px;
        font-weight: 600;
        font-size: 0.9rem;
        transition: all 0.2s;
        border: 2px solid transparent;
        cursor: pointer;
    }

    .nav-link:hover {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
    }

    .nav-link.active {
        background: var(--primary);
        color: white;
    }

    .logo {
        font-size: 2rem;
        font-weight: 900;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    .container {
        max-width: 1800px;
        margin: 2rem auto;
        padding: 0 2rem;
    }

    .tool-card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.15);
        padding: 2rem;
        margin-bottom: 2rem;
    }

    .input-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 1.5rem;
    }

    .input-group {
        display: flex;
        flex-direction: column;
    }

    label {
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: var(--dark);
        font-size: 0.9rem;
    }

    input, select {
        padding: 0.75rem;
        border: 2px solid var(--light);
        border-radius: 8px;
        font-size: 1rem;
        transition: all 0.2s;
    }

    input:focus, select:focus {
        outline: none;
        border-color: var(--primary);
    }

    .btn {
        padding: 1rem 2rem;
        border: none;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }

    .btn-primary {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(30, 60, 114, 0.4);
    }

    .btn-secondary {
        background: var(--light);
        color: var(--dark);
    }

    .btn-secondary:hover {
        background: var(--dark);
        color: white;
    }

    .results-container {
        display: none;
        margin-top: 2rem;
    }

    .results-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    .risk-card {
        background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        border-left: 5px solid var(--primary);
        padding: 1.5rem;
        border-radius: 8px;
    }

    .risk-card h3 {
        color: var(--primary);
        margin-bottom: 1rem;
        font-size: 1.1rem;
    }

    .risk-score {
        font-size: 2.5rem;
        font-weight: 900;
        margin: 0.5rem 0;
    }

    .risk-label {
        font-size: 0.9rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .peril-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.75rem;
        background: white;
        border-radius: 6px;
        margin-bottom: 0.5rem;
    }

    .peril-name {
        font-weight: 600;
    }

    .peril-score {
        font-weight: 700;
        font-size: 1.1rem;
    }

    .extreme { color: #7f1d1d; background: #fee2e2; }
    .high { color: #991b1b; background: #fecaca; }
    .moderate { color: #f59e0b; background: #fef3c7; }
    .low { color: #059669; background: #d1fae5; }
    .very-low { color: #047857; background: #d1fae5; }

    #map {
        height: 500px;
        border-radius: 8px;
        margin-top: 1rem;
    }

    .modal {
        display: none;
        position: fixed;
        z-index: 9999;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.7);
        overflow: auto;
    }

    .modal-content {
        background-color: white;
        margin: 2% auto;
        padding: 2rem;
        border-radius: 12px;
        width: 90%;
        max-width: 1200px;
        max-height: 85vh;
        overflow-y: auto;
        position: relative;
    }

    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        line-height: 20px;
    }

    .close:hover {
        color: black;
    }

    .loading {
        display: none;
        text-align: center;
        padding: 2rem;
    }

    .spinner {
        border: 4px solid var(--light);
        border-top: 4px solid var(--primary);
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        margin: 0 auto;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .external-links {
        margin-top: 2rem;
        padding: 1.5rem;
        background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
        border-radius: 8px;
        border-left: 5px solid #0284c7;
    }

    .external-links h3 {
        color: var(--primary);
        margin-bottom: 1rem;
    }

    .link-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1rem;
    }

    .ext-link {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        color: #0284c7;
        text-decoration: none;
        font-weight: 600;
        padding: 0.5rem;
        border-radius: 6px;
        transition: all 0.2s;
    }

    .ext-link:hover {
        background: white;
        transform: translateX(5px);
    }

    @media (max-width: 768px) {
        .input-grid {
            grid-template-columns: 1fr;
        }
        
        .results-grid {
            grid-template-columns: 1fr;
        }
        
        .nav-menu {
            width: 100%;
            flex-direction: column;
        }
    }
</style>
```

</head>
<body>
    <header class="header">
        <div class="logo">CATZone</div>
        <div class="nav-menu">
            <a href="#" class="nav-link active">Risk Assessment</a>
            <a href="geocat_karst_map.html" class="nav-link">Karst/Sinkhole Map</a>
            <a href="https://www.atheniumanalytics.com" target="_blank" class="nav-link">Athenium</a>
            <a href="https://www.riskmeter.com" target="_blank" class="nav-link">Risk Meter</a>
        </div>
    </header>

```
<div class="container">
    <div class="tool-card">
        <h1 style="color: var(--primary); margin-bottom: 1rem;">NATCAT Risk Intelligence Platform</h1>
        <p style="color: var(--dark); margin-bottom: 2rem;">Comprehensive natural catastrophe risk assessment for underwriting decisions</p>

        <div class="input-grid">
            <div class="input-group">
                <label for="address">Project Address</label>
                <input type="text" id="address" placeholder="Enter street address">
            </div>
            <div class="input-group">
                <label for="city">City</label>
                <input type="text" id="city" placeholder="Enter city">
            </div>
            <div class="input-group">
                <label for="state">State</label>
                <input type="text" id="state" placeholder="State (e.g., TX, FL)">
            </div>
            <div class="input-group">
                <label for="zip">ZIP Code</label>
                <input type="text" id="zip" placeholder="Enter ZIP code">
            </div>
        </div>

        <div class="input-grid">
            <div class="input-group">
                <label for="latitude">Latitude (Optional)</label>
                <input type="number" id="latitude" step="0.000001" placeholder="e.g., 30.2672">
            </div>
            <div class="input-group">
                <label for="longitude">Longitude (Optional)</label>
                <input type="number" id="longitude" step="0.000001" placeholder="e.g., -97.7431">
            </div>
            <div class="input-group">
                <label for="projectType">Project Type</label>
                <select id="projectType">
                    <option value="commercial">Commercial Construction</option>
                    <option value="residential">Residential Construction</option>
                    <option value="infrastructure">Infrastructure</option>
                    <option value="bridge">Bridge Construction</option>
                    <option value="marine">Marine/Port Facility</option>
                    <option value="water">Water/Wastewater</option>
                    <option value="healthcare">Healthcare Facility</option>
                    <option value="industrial">Industrial Facility</option>
                </select>
            </div>
            <div class="input-group">
                <label for="projectValue">Project Value ($)</label>
                <input type="number" id="projectValue" placeholder="Enter project value">
            </div>
        </div>

        <div class="input-grid">
            <div class="input-group">
                <label for="constructionType">Construction Type</label>
                <select id="constructionType" onchange="toggleRenovationOptions()">
                    <option value="new">New Construction</option>
                    <option value="renovation">Renovation/Rehab</option>
                </select>
            </div>
        </div>

        <div class="input-grid" id="structuralComplexityGroup">
            <div class="input-group">
                <label>Structural Complexity</label>
                <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                    <label style="display: flex; align-items: center; cursor: pointer; font-weight: normal;">
                        <input type="radio" name="structuralWork" id="nonStructural" value="non-structural" checked style="width: auto; margin-right: 0.5rem;">
                        Non-Structural
                    </label>
                    <label style="display: flex; align-items: center; cursor: pointer; font-weight: normal;">
                        <input type="radio" name="structuralWork" id="structural" value="structural" style="width: auto; margin-right: 0.5rem;">
                        Structural Work
                    </label>
                </div>
                <div style="font-size: 0.85rem; color: #6b7280; margin-top: 0.5rem;">
                    Structural: foundation, framing, load-bearing modifications, shoring
                </div>
            </div>
        </div>

        <div class="input-grid" id="activeOpsGroup">
            <div class="input-group">
                <label>Active Operations On-Site</label>
                <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                    <label style="display: flex; align-items: center; cursor: pointer; font-weight: normal;">
                        <input type="radio" name="activeOps" id="activeOpsNo" value="no" checked style="width: auto; margin-right: 0.5rem;">
                        No Active Operations
                    </label>
                    <label style="display: flex; align-items: center; cursor: pointer; font-weight: normal;">
                        <input type="radio" name="activeOps" id="activeOpsYes" value="yes" style="width: auto; margin-right: 0.5rem;">
                        Active Operations
                    </label>
                </div>
                <div style="font-size: 0.85rem; color: #6b7280; margin-top: 0.5rem;">
                    Does project involve construction within/adjacent to operating facility?
                </div>
            </div>
        </div>

        <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
            <button class="btn btn-primary" onclick="analyzeRisk()">
                üéØ Analyze Risk
            </button>
            <button class="btn btn-secondary" onclick="exportReport()">
                üìÑ Export Report
            </button>
            <button class="btn btn-secondary" onclick="clearForm()">
                üîÑ Clear
            </button>
        </div>
    </div>

    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p style="margin-top: 1rem; color: var(--dark);">Analyzing risk factors...</p>
    </div>

    <div class="results-container" id="results">
        <div class="tool-card">
            <h2 style="color: var(--primary); margin-bottom: 1.5rem;">Risk Assessment Results</h2>
            
            <div class="results-grid">
                <div class="risk-card">
                    <h3>Overall Risk Score</h3>
                    <div id="overallRisk"></div>
                </div>
                <div class="risk-card">
                    <h3>Location Details</h3>
                    <div id="locationDetails"></div>
                </div>
            </div>

            <div class="tool-card">
                <h3 style="color: var(--primary); margin-bottom: 1rem;">Peril Breakdown</h3>
                <div id="perilDetails"></div>
            </div>

            <div class="tool-card">
                <h3 style="color: var(--primary); margin-bottom: 1rem;">Location Map</h3>
                <div id="map"></div>
            </div>

            <div class="external-links">
                <h3>üîó Additional Risk Assessment Resources</h3>
                <div class="link-grid">
                    <a href="https://www.atheniumanalytics.com" target="_blank" class="ext-link">
                        ‚ö° Athenium Analytics
                    </a>
                    <a href="https://www.riskmeter.com" target="_blank" class="ext-link">
                        üìä Risk Meter
                    </a>
                    <a href="https://hazardhub.com" target="_blank" class="ext-link">
                        üåê Hazard Hub
                    </a>
                    <a href="https://msc.fema.gov/portal/home" target="_blank" class="ext-link">
                        üåä FEMA Flood Maps
                    </a>
                    <a href="https://www.usgs.gov/media/images/map-showing-principal-karst-areas-united-states" target="_blank" class="ext-link">
                        üï≥Ô∏è USGS Karst Map
                    </a>
                    <a href="https://www.spc.noaa.gov/climo/reports/" target="_blank" class="ext-link">
                        ‚õàÔ∏è SPC Storm Reports
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="modal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <div id="modalBody"></div>
    </div>
</div>

<script>
    let map = null;
    let marker = null;

    function toggleRenovationOptions() {
        const constructionType = document.getElementById('constructionType').value;
        const isRenovation = constructionType === 'renovation';
        
        const structuralRadios = document.querySelectorAll('input[name="structuralWork"]');
        const activeOpsRadios = document.querySelectorAll('input[name="activeOps"]');
        
        const structuralGroup = document.getElementById('structuralComplexityGroup');
        const activeOpsGroup = document.getElementById('activeOpsGroup');
        
        if (isRenovation) {
            structuralRadios.forEach(radio => radio.disabled = false);
            activeOpsRadios.forEach(radio => radio.disabled = false);
            structuralGroup.style.opacity = '1';
            activeOpsGroup.style.opacity = '1';
        } else {
            structuralRadios.forEach(radio => {
                radio.disabled = true;
                if (radio.value === 'non-structural') radio.checked = true;
            });
            activeOpsRadios.forEach(radio => {
                radio.disabled = true;
                if (radio.value === 'no') radio.checked = true;
            });
            structuralGroup.style.opacity = '0.5';
            activeOpsGroup.style.opacity = '0.5';
        }
    }

    function analyzeRisk() {
        const address = document.getElementById('address').value;
        const city = document.getElementById('city').value;
        const state = document.getElementById('state').value;
        const zip = document.getElementById('zip').value;
        let lat = parseFloat(document.getElementById('latitude').value);
        let lon = parseFloat(document.getElementById('longitude').value);

        if (!lat || !lon) {
            if (!city && !state && !zip) {
                alert('Please enter coordinates OR address information');
                return;
            }
            // Use mock coordinates for demo
            lat = 30.2672 + (Math.random() - 0.5) * 10;
            lon = -97.7431 + (Math.random() - 0.5) * 10;
        }

        document.getElementById('loading').style.display = 'block';
        document.getElementById('results').style.display = 'none';

        setTimeout(() => {
            performRiskAnalysis(lat, lon, address, city, state, zip);
            document.getElementById('loading').style.display = 'none';
            document.getElementById('results').style.display = 'block';
        }, 1500);
    }

    function performRiskAnalysis(lat, lon, address, city, state, zip) {
        const elevation = Math.random() * 1000;
        const atheniumData = getMockAtheniumData(lat, lon, state);
        const earthquakeData = { score: Math.random() * 5 };
        const wildfireData = { score: Math.random() * 8 };
        const karstData = assessKarstRisk(lat, lon);

        const overallRisk = calculateComprehensiveRisk(elevation, atheniumData, earthquakeData, wildfireData, karstData);

        displayResults(overallRisk, lat, lon, address, city, state, zip, elevation, karstData);
        initMap(lat, lon, address, city, state);
    }

    function getMockAtheniumData(lat, lon, state) {
        const isTexas = state && state.toUpperCase() === 'TX';
        const isFlorida = state && state.toUpperCase() === 'FL';
        const isGulfCoast = lat < 32 && lon > -98 && lon < -80;

        return {
            hail: isTexas ? 5 + Math.random() * 3 : 2 + Math.random() * 3,
            hailProbability: isTexas ? 20 + Math.random() * 10 : 5 + Math.random() * 10,
            wind: 3 + Math.random() * 3,
            windProbability: 40 + Math.random() * 20,
            tornado: isTexas ? 4 + Math.random() * 2 : 1 + Math.random() * 2,
            tornadoProbability: isTexas ? 3 + Math.random() * 2 : 0.5 + Math.random(),
            hurricaneWind: isGulfCoast || isFlorida ? 3 + Math.random() * 4 : 0.5 + Math.random(),
            hurricaneProbability: isGulfCoast || isFlorida ? 5 + Math.random() * 5 : 0.1 + Math.random(),
            rainfall: 4 + Math.random() * 3,
            rainfallProbability: 15 + Math.random() * 10
        };
    }

    function assessKarstRisk(lat, lon) {
        let score = 0;
        let riskLevel = 'None';
        let details = [];
        
        const karstRegions = [
            { state: 'FL', name: 'Florida', baseScore: 9, lat: [24, 31], lon: [-87.5, -79.8], note: 'Statewide karst - highest risk central FL (I-4 corridor). Excludes Keys' },
            { state: 'TN', name: 'Tennessee', baseScore: 7, lat: [34.9, 36.7], lon: [-89.5, -82], note: 'Middle/Eastern TN highland rim - Nashville, Knoxville regions' },
            { state: 'KY', name: 'Kentucky', baseScore: 7, lat: [36.5, 39.1], lon: [-89.5, -82], note: 'Mammoth Cave region, extensive karst in central/south KY' },
            { state: 'MO', name: 'Missouri', baseScore: 6, lat: [36, 38.5], lon: [-94.5, -90], note: 'Ozark Plateau karst - Springfield, Branson area' },
            { state: 'PA', name: 'Pennsylvania', baseScore: 6, lat: [39.7, 41.2], lon: [-80, -76], note: 'Appalachian karst belt - central/south-central PA' },
            { state: 'TX', name: 'Texas', baseScore: 5, lat: [29.5, 31.5], lon: [-101, -97.5], note: 'Edwards Plateau only - Austin, San Antonio area' },
            { state: 'IN', name: 'Indiana', baseScore: 5, lat: [37.8, 39.5], lon: [-87.5, -85.5], note: 'Southern Indiana karst belt - Mitchell plain' },
            { state: 'AL', name: 'Alabama', baseScore: 5, lat: [33, 35], lon: [-88, -85.5], note: 'Northern Alabama karst - Huntsville region' },
            { state: 'VA', name: 'Virginia', baseScore: 5, lat: [36.5, 39.5], lon: [-81.5, -78], note: 'Shenandoah Valley karst - I-81 corridor' },
            { state: 'WV', name: 'West Virginia', baseScore: 5, lat: [37.2, 40.6], lon: [-82, -78], note: 'Greenbrier Valley karst - eastern panhandle' }
        ];
        
        for (const region of karstRegions) {
            if (lat >= region.lat[0] && lat <= region.lat[1] && 
                lon >= region.lon[0] && lon <= region.lon[1]) {
                score = region.baseScore;
                details.push(`Located in ${region.name} karst region`);
                details.push(region.note);
                break;
            }
        }
        
        if (score > 0) {
            score += 1;
            details.push('Urban development may increase sinkhole risk');
        }
        
        if (score >= 8) {
            riskLevel = 'Extreme';
        } else if (score >= 6) {
            riskLevel = 'High';
        } else if (score >= 4) {
            riskLevel = 'Moderate';
        } else if (score >= 2) {
            riskLevel = 'Low';
        } else {
            riskLevel = 'Very Low';
        }
        
        return {
            score: Math.min(10, score),
            riskLevel: riskLevel,
            details: details,
            mapLink: score > 0
        };
    }

    function calculateComprehensiveRisk(elevation, atheniumData, earthquakeData, wildfireData, karstData) {
        let baseRisk = 30;
        const perils = {};
        
        if (elevation !== null) {
            if (elevation < 5) baseRisk += 15;
            else if (elevation < 50) baseRisk += 10;
            else if (elevation > 5000) baseRisk += 5;
        }

        // CRITICAL FIX: Calculate SCS composite score ONCE
        // Combine wind + tornado + hail into single SCS score
        const scsWindScore = Math.max(atheniumData.wind, atheniumData.tornado);
        const scsHailScore = atheniumData.hail;
        const scsCompositeScore = Math.max(scsWindScore, scsHailScore);

        perils['Severe Convective Storm'] = {
            score: scsCompositeScore,
            details: `Wind: ${atheniumData.wind.toFixed(1)}/10 | Tornado: ${atheniumData.tornado.toFixed(1)}/10 | Hail: ${scsHailScore.toFixed(1)}/10`
        };

        // Hurricane
        const hurricaneScore = atheniumData.hurricaneWind;
        perils['Hurricane/Tropical Cyclone'] = {
            score: hurricaneScore,
            details: `Wind risk: ${hurricaneScore.toFixed(1)}/10 | Probability: ${atheniumData.hurricaneProbability.toFixed(1)}%`
        };

        // Flood/Rainfall
        const floodScore = atheniumData.rainfall;
        perils['Flood/Excessive Rainfall'] = {
            score: floodScore,
            details: `Rainfall risk: ${floodScore.toFixed(1)}/10 | Annual probability: ${atheniumData.rainfallProbability.toFixed(1)}%`
        };

        // Earthquake
        const earthquakeScore = earthquakeData.score;
        perils['Earthquake'] = {
            score: earthquakeScore,
            details: `Seismic activity: ${earthquakeScore.toFixed(1)}/10`
        };

        // Wildfire
        const wildfireScore = wildfireData.score;
        perils['Wildfire'] = {
            score: wildfireScore,
            details: `Wildland proximity risk: ${wildfireScore.toFixed(1)}/10`
        };

        // Karst
        perils['Karst/Sinkhole'] = {
            score: karstData.score,
            details: karstData.details.join(' ‚Ä¢ ')
        };

        // Calculate overall risk using weighted average
        const weights = {
            'Severe Convective Storm': 0.30,
            'Hurricane/Tropical Cyclone': 0.20,
            'Flood/Excessive Rainfall': 0.20,
            'Earthquake': 0.10,
            'Wildfire': 0.10,
            'Karst/Sinkhole': 0.10
        };

        let weightedSum = 0;
        for (const [peril, data] of Object.entries(perils)) {
            weightedSum += data.score * weights[peril];
        }

        let overallScore = Math.min(10, weightedSum);
        
        // Apply project-specific multipliers
        const projectType = document.getElementById('projectType').value;
        const typeMultipliers = {
            'marine': 1.15,
            'bridge': 1.12,
            'water': 1.10,
            'infrastructure': 1.08,
            'healthcare': 1.05,
            'industrial': 1.03,
            'commercial': 1.0,
            'residential': 0.98
        };
        
        const constructionType = document.getElementById('constructionType').value;
        const constructionMultiplier = constructionType === 'renovation' ? 1.12 : 1.0;
        
        const structuralWork = document.querySelector('input[name="structuralWork"]:checked')?.value === 'structural';
        const structuralMultiplier = structuralWork ? 1.15 : 1.0;
        
        const activeOps = document.querySelector('input[name="activeOps"]:checked')?.value === 'yes';
        const activeOpsMultiplier = activeOps ? 1.25 : 1.0;
        
        overallScore = overallScore * (typeMultipliers[projectType] || 1.0) * constructionMultiplier * structuralMultiplier * activeOpsMultiplier;
        overallScore = Math.min(10, overallScore);
        
        let overallRiskLevel;
        
        if (overallScore >= 8) overallRiskLevel = 'Extreme';
        else if (overallScore >= 6) overallRiskLevel = 'High';
        else if (overallScore >= 4) overallRiskLevel = 'Moderate';
        else if (overallScore >= 2) overallRiskLevel = 'Low';
        else overallRiskLevel = 'Very Low';

        return {
            overallScore: overallScore,
            overallRiskLevel: overallRiskLevel,
            perils: perils,
            elevation: elevation
        };
    }

    function displayResults(riskData, lat, lon, address, city, state, zip, elevation, karstData) {
        const overallDiv = document.getElementById('overallRisk');
        const locationDiv = document.getElementById('locationDetails');
        const perilDiv = document.getElementById('perilDetails');

        const riskClass = riskData.overallRiskLevel.toLowerCase().replace(' ', '-');
        
        overallDiv.innerHTML = `
            <div class="risk-score ${riskClass}">${riskData.overallScore.toFixed(1)}</div>
            <div class="risk-label ${riskClass}">${riskData.overallRiskLevel} Risk</div>
        `;

        locationDiv.innerHTML = `
            <div style="line-height: 1.8;">
                <div><strong>Address:</strong> ${address || 'N/A'}</div>
                <div><strong>City:</strong> ${city || 'N/A'}</div>
                <div><strong>State:</strong> ${state || 'N/A'}</div>
                <div><strong>ZIP:</strong> ${zip || 'N/A'}</div>
                <div><strong>Coordinates:</strong> ${lat.toFixed(4)}, ${lon.toFixed(4)}</div>
                <div><strong>Elevation:</strong> ${elevation.toFixed(0)} ft</div>
            </div>
        `;

        let perilHTML = '';
        for (const [peril, data] of Object.entries(riskData.perils)) {
            const perilClass = getScoreClass(data.score);
            perilHTML += `
                <div class="peril-item">
                    <div>
                        <div class="peril-name">${peril}</div>
                        <div style="font-size: 0.85rem; color: #6b7280; margin-top: 0.25rem;">${data.details}</div>
                    </div>
                    <div class="peril-score ${perilClass}">${data.score.toFixed(1)}</div>
                </div>
            `;
        }

        if (karstData.mapLink) {
            perilHTML += `
                <div style="margin-top: 1rem; padding: 1rem; background: #fef3c7; border-radius: 8px;">
                    <strong>‚ö†Ô∏è Karst Terrain Detected</strong><br>
                    <a href="geocat_karst_map.html" target="_blank" style="color: #0284c7; text-decoration: underline; font-weight: 600;">
                        View Detailed Karst/Sinkhole Risk Map ‚Üí
                    </a>
                </div>
            `;
        }

        perilDiv.innerHTML = perilHTML;
    }

    function getScoreClass(score) {
        if (score >= 8) return 'extreme';
        if (score >= 6) return 'high';
        if (score >= 4) return 'moderate';
        if (score >= 2) return 'low';
        return 'very-low';
    }

    function initMap(lat, lon, address, city, state) {
        if (map) {
            map.remove();
        }

        map = L.map('map').setView([lat, lon], 11);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors'
        }).addTo(map);

        marker = L.marker([lat, lon]).addTo(map);
        marker.bindPopup(`<b>${address || 'Project Location'}</b><br>${city || ''}, ${state || ''}`).openPopup();
    }

    function clearForm() {
        document.getElementById('address').value = '';
        document.getElementById('city').value = '';
        document.getElementById('state').value = '';
        document.getElementById('zip').value = '';
        document.getElementById('latitude').value = '';
        document.getElementById('longitude').value = '';
        document.getElementById('projectValue').value = '';
        document.getElementById('results').style.display = 'none';
    }

    function exportReport() {
        const resultsDiv = document.getElementById('results');
        if (resultsDiv.style.display === 'none') {
            alert('Please run a risk analysis first');
            return;
        }

        alert('Report export functionality coming soon. This will generate a PDF report with all risk details.');
    }

    function closeModal() {
        document.getElementById('modal').style.display = 'none';
    }

    window.onclick = function(event) {
        const modal = document.getElementById('modal');
        if (event.target == modal) {
            modal.style.display = 'none';
        }
    }

    // Initialize on page load
    window.addEventListener('DOMContentLoaded', function() {
        toggleRenovationOptions();
    });
</script>
```

</body>
</html>