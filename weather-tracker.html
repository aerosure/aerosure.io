<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Tracker | aerosure Command Center</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --cyan-400: #22d3ee; --cyan-500: #06b6d4; --blue-400: #60a5fa; --blue-500: #3b82f6;
            --orange-400: #fb923c; --orange-500: #f97316;
            --bg-primary: #030712; --bg-secondary: #0a0f1a; --bg-card: rgba(15, 23, 42, 0.6);
            --border-subtle: rgba(255, 255, 255, 0.06); --border-medium: rgba(255, 255, 255, 0.1);
            --text-primary: #f8fafc; --text-secondary: #94a3b8; --text-tertiary: #64748b;
            --success: #4ade80; --warning: #fbbf24; --error: #f87171;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', -apple-system, sans-serif; background: var(--bg-primary); color: var(--text-primary); line-height: 1.6; min-height: 100vh; }
        .bg-noise { position: fixed; top: 0; left: 0; width: 100%; height: 100%; opacity: 0.015; pointer-events: none; z-index: 0; background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E"); }
        nav { position: fixed; top: 0; left: 0; right: 0; z-index: 1000; padding: 1rem 2rem; background: rgba(3,7,18,0.9); backdrop-filter: blur(20px); border-bottom: 1px solid var(--border-subtle); }
        .nav-container { max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
        .logo { display: flex; align-items: center; text-decoration: none; }
        .logo-img { height: 40px; }
        .nav-links { display: flex; gap: 8px; }
        .nav-link { padding: 8px 16px; color: var(--text-secondary); text-decoration: none; font-size: 0.85rem; font-weight: 500; border-radius: 8px; transition: all 0.2s; }
        .nav-link:hover { color: var(--text-primary); background: rgba(255,255,255,0.05); }
        .nav-link.active { color: var(--cyan-400); background: rgba(6,182,212,0.1); }
        main { position: relative; z-index: 1; padding: 100px 2rem 60px; max-width: 1400px; margin: 0 auto; }
        .page-header { text-align: center; margin-bottom: 32px; }
        .page-header h1 { font-size: 2.25rem; font-weight: 800; letter-spacing: -1px; margin-bottom: 8px; background: linear-gradient(135deg, var(--cyan-400), var(--blue-400)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .page-header p { color: var(--text-secondary); }

        /* Status Banner */
        .status-banner { display: flex; align-items: center; justify-content: center; gap: 16px; padding: 20px 32px; border-radius: 16px; margin-bottom: 32px; }
        .status-banner.go { background: linear-gradient(135deg, rgba(74,222,128,0.15), rgba(74,222,128,0.05)); border: 2px solid var(--success); }
        .status-banner.caution { background: linear-gradient(135deg, rgba(251,191,36,0.15), rgba(251,191,36,0.05)); border: 2px solid var(--warning); }
        .status-banner.no-go { background: linear-gradient(135deg, rgba(248,113,113,0.15), rgba(248,113,113,0.05)); border: 2px solid var(--error); }
        .status-icon { font-size: 2.5rem; }
        .status-content h2 { font-size: 1.5rem; font-weight: 700; }
        .status-content p { font-size: 0.9rem; color: var(--text-secondary); }

        /* Current Conditions */
        .current-conditions { background: var(--bg-card); border: 1px solid var(--border-medium); border-radius: 20px; padding: 32px; margin-bottom: 32px; }
        .conditions-grid { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 32px; align-items: center; }
        .main-temp { text-align: center; }
        .temp-value { font-size: 5rem; font-weight: 800; color: var(--cyan-400); line-height: 1; }
        .temp-desc { font-size: 1.25rem; color: var(--text-secondary); margin-top: 8px; text-transform: capitalize; }
        .temp-feels { font-size: 0.9rem; color: var(--text-tertiary); margin-top: 8px; }
        .condition-item { text-align: center; padding: 20px; background: rgba(0,0,0,0.2); border-radius: 12px; }
        .condition-value { font-size: 2rem; font-weight: 700; color: var(--text-primary); margin-bottom: 4px; }
        .condition-label { font-size: 0.75rem; color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 1px; }
        .condition-detail { font-size: 0.85rem; color: var(--text-secondary); margin-top: 8px; }

        /* Flight Decision Panel */
        .flight-decision { background: var(--bg-card); border: 2px solid var(--cyan-500); border-radius: 20px; padding: 28px; margin-bottom: 32px; }
        .decision-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .decision-header h3 { font-size: 1.1rem; font-weight: 600; color: var(--cyan-400); }
        .decision-header span { font-size: 0.85rem; color: var(--text-tertiary); }
        .decision-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; }
        .decision-metric { padding: 16px; background: rgba(0,0,0,0.3); border-radius: 10px; border-left: 4px solid var(--success); }
        .decision-metric.warning { border-left-color: var(--warning); }
        .decision-metric.danger { border-left-color: var(--error); }
        .metric-label { font-size: 0.7rem; color: var(--text-tertiary); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 4px; }
        .metric-value { font-size: 1.25rem; font-weight: 700; }
        .metric-value.safe { color: var(--success); }
        .metric-value.warning { color: var(--warning); }
        .metric-value.danger { color: var(--error); }

        /* Windy Map */
        .map-section { background: var(--bg-card); border: 1px solid var(--border-medium); border-radius: 20px; padding: 24px; margin-bottom: 32px; }
        .section-header { display: flex; align-items: center; gap: 12px; margin-bottom: 20px; }
        .section-header h3 { font-size: 1.1rem; font-weight: 600; }
        .map-wrapper { border-radius: 12px; overflow: hidden; }
        .map-wrapper iframe { display: block; width: 100%; height: 450px; border: none; }

        /* 7-Day Forecast */
        .forecast-section { margin-bottom: 32px; }
        .forecast-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 12px; }
        .forecast-day { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: 16px; padding: 20px 12px; text-align: center; transition: all 0.3s; }
        .forecast-day:hover { border-color: var(--border-medium); transform: translateY(-4px); }
        .forecast-day.today { border-color: var(--cyan-500); background: rgba(6,182,212,0.05); }
        .day-name { font-size: 0.85rem; color: var(--text-secondary); font-weight: 500; }
        .day-date { font-size: 0.75rem; color: var(--text-tertiary); margin-bottom: 12px; }
        .weather-icon { font-size: 2rem; margin-bottom: 12px; }
        .temp-range { display: flex; justify-content: center; gap: 8px; margin-bottom: 8px; }
        .temp-high { font-size: 1.1rem; font-weight: 700; }
        .temp-low { font-size: 1.1rem; color: var(--text-tertiary); }
        .wind-info { font-size: 0.75rem; color: var(--text-tertiary); margin-bottom: 8px; }
        .flight-indicator { padding: 4px 10px; border-radius: 100px; font-size: 0.7rem; font-weight: 700; display: inline-block; }
        .flight-indicator.go { background: rgba(74,222,128,0.2); color: var(--success); }
        .flight-indicator.caution { background: rgba(251,191,36,0.2); color: var(--warning); }
        .flight-indicator.no-go { background: rgba(248,113,113,0.2); color: var(--error); }

        footer { text-align: center; padding: 32px; border-top: 1px solid var(--border-subtle); }
        footer p { font-size: 0.8rem; color: var(--text-tertiary); }
        footer a { color: var(--cyan-400); text-decoration: none; }

        @media (max-width: 1024px) { .conditions-grid { grid-template-columns: 1fr 1fr; } .forecast-grid { grid-template-columns: repeat(4, 1fr); } }
        @media (max-width: 768px) { .nav-links { display: none; } main { padding: 90px 1rem 40px; } .conditions-grid { grid-template-columns: 1fr; } .decision-grid { grid-template-columns: repeat(2, 1fr); } .forecast-grid { grid-template-columns: repeat(2, 1fr); } }
    </style>
</head>
<body>
    <div class="bg-noise"></div>
    <nav>
        <div class="nav-container">
            <a href="index.html" class="logo"><img src="aerosure_io_logo.png" alt="aerosure" class="logo-img"></a>
            <div class="nav-links">
                <a href="command-center.html" class="nav-link">Command Center</a>
                <a href="airspace-ops.html" class="nav-link">Airspace Ops</a>
                <a href="weather-tracker.html" class="nav-link active">Weather</a>
                <a href="storm-tracker.html" class="nav-link">Storms</a>
            </div>
        </div>
    </nav>

    <main>
        <div class="page-header">
            <h1>‚õÖ Flight Weather Tracker</h1>
            <p>Real-time conditions for drone operations ‚Ä¢ Richmond Metro</p>
        </div>

        <!-- Status Banner -->
        <div class="status-banner go" id="statusBanner">
            <div class="status-icon" id="statusIcon">‚úì</div>
            <div class="status-content">
                <h2 id="statusTitle">CONDITIONS: GO</h2>
                <p id="statusDesc">All systems favorable for flight operations</p>
            </div>
        </div>

        <!-- Current Conditions -->
        <div class="current-conditions">
            <div class="conditions-grid">
                <div class="main-temp">
                    <div class="temp-value" id="currentTemp">--¬∞</div>
                    <div class="temp-desc" id="currentDesc">Loading...</div>
                    <div class="temp-feels">Feels like <span id="feelsLike">--¬∞</span></div>
                </div>
                <div class="condition-item">
                    <div class="condition-value" id="windSpeed">-- mph</div>
                    <div class="condition-label">Wind Speed</div>
                    <div class="condition-detail" id="windDir">--</div>
                </div>
                <div class="condition-item">
                    <div class="condition-value" id="visibility">-- mi</div>
                    <div class="condition-label">Visibility</div>
                    <div class="condition-detail" id="visQuality">--</div>
                </div>
                <div class="condition-item">
                    <div class="condition-value" id="humidity">--%</div>
                    <div class="condition-label">Humidity</div>
                    <div class="condition-detail" id="dewPoint">Dew: --¬∞</div>
                </div>
            </div>
        </div>

        <!-- Flight Decision Panel -->
        <div class="flight-decision">
            <div class="decision-header">
                <h3>üìã Flight Criteria Status</h3>
                <span>Updated: <span id="lastUpdate">--</span></span>
            </div>
            <div class="decision-grid">
                <div class="decision-metric" id="windMetric">
                    <div class="metric-label">Wind Threshold</div>
                    <div class="metric-value safe" id="windStatus">SAFE</div>
                </div>
                <div class="decision-metric" id="visMetric">
                    <div class="metric-label">Visibility</div>
                    <div class="metric-value safe" id="visStatus">CLEAR</div>
                </div>
                <div class="decision-metric" id="precipMetric">
                    <div class="metric-label">Precipitation</div>
                    <div class="metric-value safe" id="precipStatus">NONE</div>
                </div>
                <div class="decision-metric" id="tempMetric">
                    <div class="metric-label">Temperature</div>
                    <div class="metric-value safe" id="tempStatus">OPTIMAL</div>
                </div>
            </div>
        </div>

        <!-- Windy Map -->
        <div class="map-section">
            <div class="section-header">
                <span style="font-size:1.5rem;">üó∫Ô∏è</span>
                <h3>Live Weather Radar</h3>
            </div>
            <div class="map-wrapper">
                <iframe src="https://embed.windy.com/embed2.html?lat=37.541&lon=-77.436&detailLat=37.541&detailLon=-77.436&width=650&height=450&zoom=9&level=surface&overlay=radar&product=radar&menu=&message=true&marker=&calendar=now&pressure=true&type=map&location=coordinates&detail=&metricWind=mph&metricTemp=%C2%B0F&radarRange=-1"></iframe>
            </div>
        </div>

        <!-- 7-Day Forecast -->
        <div class="forecast-section">
            <div class="section-header">
                <span style="font-size:1.5rem;">üìÖ</span>
                <h3>7-Day Flight Forecast</h3>
            </div>
            <div class="forecast-grid" id="forecastGrid">
                <!-- Populated by JS -->
            </div>
        </div>
    </main>

    <footer><p>Data: OpenWeatherMap, NWS | <a href="command-center.html">‚Üê Back to Command Center</a></p></footer>

    <script>
        const API_KEY = '96a0c5d3ea09e85deea208f1d1a805af';
        const LAT = 37.5407, LON = -77.4360;

        async function getCurrentWeather() {
            try {
                const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${LAT}&lon=${LON}&appid=${API_KEY}&units=imperial`);
                const data = await res.json();
                updateConditions(data);
                updateDecision(data);
                updateBanner(data);
            } catch (e) { console.error(e); }
        }

        async function getForecast() {
            try {
                const res = await fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${LAT}&lon=${LON}&appid=${API_KEY}&units=imperial&cnt=56`);
                const data = await res.json();
                updateForecast(data);
            } catch (e) { console.error(e); }
        }

        function updateConditions(d) {
            document.getElementById('currentTemp').textContent = Math.round(d.main.temp) + '¬∞';
            document.getElementById('currentDesc').textContent = d.weather[0].description;
            document.getElementById('feelsLike').textContent = Math.round(d.main.feels_like) + '¬∞';
            document.getElementById('windSpeed').textContent = Math.round(d.wind.speed) + ' mph';
            document.getElementById('windDir').textContent = 'From ' + getWindDir(d.wind.deg);
            const vis = (d.visibility / 1609.34).toFixed(1);
            document.getElementById('visibility').textContent = vis + ' mi';
            document.getElementById('visQuality').textContent = vis >= 5 ? 'Excellent' : vis >= 3 ? 'Good' : 'Limited';
            document.getElementById('humidity').textContent = d.main.humidity + '%';
            document.getElementById('dewPoint').textContent = 'Dew: ' + Math.round(d.main.temp - ((100 - d.main.humidity) / 5)) + '¬∞';
            document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
        }

        function updateDecision(d) {
            // Wind
            const wm = document.getElementById('windMetric'), ws = document.getElementById('windStatus');
            if (d.wind.speed < 20) { wm.className = 'decision-metric'; ws.className = 'metric-value safe'; ws.textContent = 'SAFE'; }
            else if (d.wind.speed < 25) { wm.className = 'decision-metric warning'; ws.className = 'metric-value warning'; ws.textContent = 'CAUTION'; }
            else { wm.className = 'decision-metric danger'; ws.className = 'metric-value danger'; ws.textContent = 'NO-GO'; }
            // Visibility
            const vm = document.getElementById('visMetric'), vs = document.getElementById('visStatus');
            const visMi = d.visibility / 1609.34;
            if (visMi >= 3) { vm.className = 'decision-metric'; vs.className = 'metric-value safe'; vs.textContent = 'CLEAR'; }
            else if (visMi >= 1) { vm.className = 'decision-metric warning'; vs.className = 'metric-value warning'; vs.textContent = 'LIMITED'; }
            else { vm.className = 'decision-metric danger'; vs.className = 'metric-value danger'; vs.textContent = 'POOR'; }
            // Precip
            const pm = document.getElementById('precipMetric'), ps = document.getElementById('precipStatus');
            if (d.weather[0].main === 'Rain' || d.weather[0].main === 'Snow') { pm.className = 'decision-metric danger'; ps.className = 'metric-value danger'; ps.textContent = 'ACTIVE'; }
            else if (d.clouds && d.clouds.all > 80) { pm.className = 'decision-metric warning'; ps.className = 'metric-value warning'; ps.textContent = 'RISK'; }
            else { pm.className = 'decision-metric'; ps.className = 'metric-value safe'; ps.textContent = 'NONE'; }
            // Temp
            const tm = document.getElementById('tempMetric'), ts = document.getElementById('tempStatus');
            if (d.main.temp >= 40 && d.main.temp <= 90) { tm.className = 'decision-metric'; ts.className = 'metric-value safe'; ts.textContent = 'OPTIMAL'; }
            else if (d.main.temp >= 32 && d.main.temp <= 95) { tm.className = 'decision-metric warning'; ts.className = 'metric-value warning'; ts.textContent = 'MARGINAL'; }
            else { tm.className = 'decision-metric danger'; ts.className = 'metric-value danger'; ts.textContent = 'EXTREME'; }
        }

        function updateBanner(d) {
            const banner = document.getElementById('statusBanner');
            const icon = document.getElementById('statusIcon');
            const title = document.getElementById('statusTitle');
            const desc = document.getElementById('statusDesc');
            const goodWind = d.wind.speed < 20, goodVis = d.visibility / 1609.34 >= 3;
            const goodPrecip = d.weather[0].main !== 'Rain' && d.weather[0].main !== 'Snow';
            const goodTemp = d.main.temp >= 40 && d.main.temp <= 90;
            if (goodWind && goodVis && goodPrecip && goodTemp) {
                banner.className = 'status-banner go'; icon.textContent = '‚úì'; title.textContent = 'CONDITIONS: GO'; desc.textContent = 'All systems favorable for flight operations';
            } else if (!goodPrecip || !goodVis || d.wind.speed >= 25) {
                banner.className = 'status-banner no-go'; icon.textContent = '‚úï'; title.textContent = 'CONDITIONS: NO-GO'; desc.textContent = 'Weather not suitable for safe drone operations';
            } else {
                banner.className = 'status-banner caution'; icon.textContent = '‚ö†'; title.textContent = 'CONDITIONS: CAUTION'; desc.textContent = 'Marginal conditions ‚Äî assess carefully before flight';
            }
        }

        function updateForecast(data) {
            const grid = document.getElementById('forecastGrid');
            grid.innerHTML = '';
            const daily = {};
            data.list.forEach(item => {
                const date = new Date(item.dt * 1000).toLocaleDateString('en-US');
                if (!daily[date]) daily[date] = { date: new Date(item.dt * 1000), temps: [], conditions: [], wind: [] };
                daily[date].temps.push(item.main.temp);
                daily[date].conditions.push(item.weather[0]);
                daily[date].wind.push(item.wind.speed);
            });
            const days = Object.values(daily).slice(0, 7);
            const today = new Date().toLocaleDateString('en-US');
            days.forEach(day => {
                const maxT = Math.round(Math.max(...day.temps)), minT = Math.round(Math.min(...day.temps));
                const avgW = Math.round(day.wind.reduce((a,b)=>a+b,0)/day.wind.length);
                const condCounts = {}; day.conditions.forEach(c => condCounts[c.main] = (condCounts[c.main]||0)+1);
                const mainCond = Object.keys(condCounts).reduce((a,b) => condCounts[a] > condCounts[b] ? a : b);
                let fClass = 'go', fText = 'GO';
                if (avgW >= 25 || mainCond === 'Rain' || mainCond === 'Snow') { fClass = 'no-go'; fText = 'NO-GO'; }
                else if (avgW >= 20 || mainCond === 'Clouds') { fClass = 'caution'; fText = 'CAUTION'; }
                const card = document.createElement('div');
                card.className = 'forecast-day' + (day.date.toLocaleDateString('en-US') === today ? ' today' : '');
                card.innerHTML = `
                    <div class="day-name">${day.date.toLocaleDateString('en-US',{weekday:'short'})}</div>
                    <div class="day-date">${day.date.toLocaleDateString('en-US',{month:'short',day:'numeric'})}</div>
                    <div class="weather-icon">${getIcon(mainCond)}</div>
                    <div class="temp-range"><span class="temp-high">${maxT}¬∞</span><span class="temp-low">${minT}¬∞</span></div>
                    <div class="wind-info">üí® ${avgW} mph</div>
                    <span class="flight-indicator ${fClass}">${fText}</span>
                `;
                grid.appendChild(card);
            });
        }

        function getIcon(c) {
            const icons = { Clear:'‚òÄÔ∏è', Clouds:'‚òÅÔ∏è', Rain:'üåßÔ∏è', Drizzle:'üåßÔ∏è', Thunderstorm:'‚õàÔ∏è', Snow:'‚ùÑÔ∏è', Mist:'üå´Ô∏è', Fog:'üå´Ô∏è' };
            return icons[c] || '‚òÅÔ∏è';
        }

        function getWindDir(deg) {
            const dirs = ['N','NNE','NE','ENE','E','ESE','SE','SSE','S','SSW','SW','WSW','W','WNW','NW','NNW'];
            return dirs[Math.round(deg/22.5)%16];
        }

        getCurrentWeather();
        getForecast();
        setInterval(() => { getCurrentWeather(); getForecast(); }, 300000);
    </script>
</body>
</html>
