<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Command Center | AeroSure</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/maplibre-gl@3.3.1/dist/maplibre-gl.css">
    <script src="https://unpkg.com/maplibre-gl@3.3.1/dist/maplibre-gl.js"></script>
    <style>
        :root {
            --cyan-400: #22d3ee;
            --cyan-500: #06b6d4;
            --red-500: #ef4444;
            --red-600: #dc2626;
            --orange-500: #f97316;
            --yellow-500: #eab308;
            --green-500: #22c55e;
            --purple-500: #8b5cf6;
            
            --bg-primary: #030712;
            --bg-secondary: #0a0f1a;
            --bg-panel: rgba(10, 15, 26, 0.95);
            --bg-card: rgba(15, 23, 42, 0.8);
            
            --border-subtle: rgba(255, 255, 255, 0.06);
            --border-medium: rgba(255, 255, 255, 0.1);
            --border-glow: rgba(6, 182, 212, 0.3);
            
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --text-tertiary: #64748b;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow: hidden;
            height: 100vh;
        }

        /* Top Header Bar */
        .header-bar {
            height: 56px;
            background: var(--bg-panel);
            border-bottom: 1px solid var(--border-medium);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            position: relative;
            z-index: 100;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .logo-img {
            height: 36px;
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: 12px;
            padding-left: 24px;
            border-left: 1px solid var(--border-medium);
        }

        .header-title h1 {
            font-size: 1rem;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .header-title .badge {
            background: rgba(6, 182, 212, 0.15);
            border: 1px solid rgba(6, 182, 212, 0.3);
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--cyan-400);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .header-center {
            display: flex;
            align-items: center;
            gap: 32px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--green-500);
            box-shadow: 0 0 10px var(--green-500);
            animation: pulse-glow 2s infinite;
        }

        .status-dot.warning {
            background: var(--yellow-500);
            box-shadow: 0 0 10px var(--yellow-500);
        }

        .status-dot.critical {
            background: var(--red-500);
            box-shadow: 0 0 10px var(--red-500);
            animation: pulse-critical 1s infinite;
        }

        @keyframes pulse-glow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        @keyframes pulse-critical {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.2); }
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .live-clock {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.1rem;
            font-weight: 500;
            color: var(--text-primary);
            background: rgba(0, 0, 0, 0.3);
            padding: 8px 16px;
            border-radius: 6px;
            border: 1px solid var(--border-subtle);
        }

        .live-clock .date {
            font-size: 0.75rem;
            color: var(--text-tertiary);
            margin-right: 12px;
        }

        .cat-mode-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: linear-gradient(135deg, var(--red-600), var(--red-500));
            border: none;
            border-radius: 6px;
            color: white;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.3);
        }

        .cat-mode-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 0 30px rgba(239, 68, 68, 0.5);
        }

        .cat-mode-btn.active {
            animation: cat-pulse 1.5s infinite;
        }

        @keyframes cat-pulse {
            0%, 100% { box-shadow: 0 0 20px rgba(239, 68, 68, 0.5); }
            50% { box-shadow: 0 0 40px rgba(239, 68, 68, 0.8); }
        }

        .nav-link {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.85rem;
            font-weight: 500;
            transition: color 0.2s;
        }

        .nav-link:hover {
            color: var(--cyan-400);
        }

        /* Main Layout */
        .main-container {
            display: grid;
            grid-template-columns: 1fr 420px;
            grid-template-rows: 1fr auto;
            height: calc(100vh - 56px);
            gap: 0;
        }

        /* Map Panel */
        .map-panel {
            position: relative;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-medium);
        }

        #threat-map {
            width: 100%;
            height: 100%;
        }

        .map-controls {
            position: absolute;
            top: 16px;
            left: 16px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            z-index: 10;
        }

        .map-control-group {
            background: var(--bg-panel);
            border: 1px solid var(--border-medium);
            border-radius: 8px;
            padding: 12px;
            backdrop-filter: blur(10px);
        }

        .map-control-group h4 {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-tertiary);
            margin-bottom: 10px;
        }

        .layer-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .layer-toggle:hover {
            opacity: 0.8;
        }

        .layer-toggle input {
            display: none;
        }

        .layer-toggle .toggle-switch {
            width: 36px;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            position: relative;
            transition: background 0.2s;
        }

        .layer-toggle input:checked + .toggle-switch {
            background: var(--cyan-500);
        }

        .layer-toggle .toggle-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            transition: transform 0.2s;
        }

        .layer-toggle input:checked + .toggle-switch::after {
            transform: translateX(16px);
        }

        .layer-toggle span {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .map-legend {
            position: absolute;
            bottom: 16px;
            left: 16px;
            background: var(--bg-panel);
            border: 1px solid var(--border-medium);
            border-radius: 8px;
            padding: 12px 16px;
            backdrop-filter: blur(10px);
            z-index: 10;
        }

        .legend-title {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-tertiary);
            margin-bottom: 10px;
        }

        .legend-items {
            display: flex;
            gap: 16px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }

        /* Right Panel */
        .right-panel {
            display: flex;
            flex-direction: column;
            background: var(--bg-panel);
            overflow: hidden;
        }

        .panel-section {
            border-bottom: 1px solid var(--border-medium);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .panel-section.alerts {
            flex: 1;
            min-height: 200px;
        }

        .panel-section.missions {
            flex: 1;
            min-height: 200px;
        }

        .panel-section.pilots {
            height: 180px;
        }

        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 16px;
            background: rgba(0, 0, 0, 0.2);
            border-bottom: 1px solid var(--border-subtle);
            flex-shrink: 0;
        }

        .panel-header h3 {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .panel-header .count {
            background: var(--cyan-500);
            color: var(--bg-primary);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 700;
        }

        .panel-header .count.warning {
            background: var(--yellow-500);
        }

        .panel-header .count.critical {
            background: var(--red-500);
            color: white;
        }

        .panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 12px;
        }

        .panel-content::-webkit-scrollbar {
            width: 6px;
        }

        .panel-content::-webkit-scrollbar-track {
            background: transparent;
        }

        .panel-content::-webkit-scrollbar-thumb {
            background: var(--border-medium);
            border-radius: 3px;
        }

        /* Alert Cards */
        .alert-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            border-left: 3px solid var(--yellow-500);
            transition: all 0.2s;
        }

        .alert-card:hover {
            background: rgba(22, 33, 54, 0.9);
            border-color: var(--border-medium);
        }

        .alert-card.warning {
            border-left-color: var(--orange-500);
        }

        .alert-card.critical {
            border-left-color: var(--red-500);
            background: rgba(239, 68, 68, 0.1);
        }

        .alert-card.watch {
            border-left-color: var(--yellow-500);
        }

        .alert-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 6px;
        }

        .alert-type {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .alert-type.warning { color: var(--orange-500); }
        .alert-type.critical { color: var(--red-500); }
        .alert-type.watch { color: var(--yellow-500); }

        .alert-time {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.7rem;
            color: var(--text-tertiary);
        }

        .alert-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .alert-location {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        /* Mission Cards */
        .mission-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            padding: 14px;
            margin-bottom: 10px;
            transition: all 0.2s;
        }

        .mission-card:hover {
            background: rgba(22, 33, 54, 0.9);
            border-color: var(--border-medium);
        }

        .mission-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .mission-id {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--cyan-400);
        }

        .mission-status {
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 4px 10px;
            border-radius: 4px;
        }

        .mission-status.pending {
            background: rgba(234, 179, 8, 0.2);
            color: var(--yellow-500);
        }

        .mission-status.assigned {
            background: rgba(6, 182, 212, 0.2);
            color: var(--cyan-400);
        }

        .mission-status.in-progress {
            background: rgba(34, 197, 94, 0.2);
            color: var(--green-500);
        }

        .mission-status.urgent {
            background: rgba(239, 68, 68, 0.2);
            color: var(--red-500);
        }

        .mission-address {
            font-size: 0.85rem;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .mission-meta {
            display: flex;
            gap: 16px;
            font-size: 0.75rem;
            color: var(--text-tertiary);
        }

        .mission-meta span {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* Pilot Status */
        .pilot-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .pilot-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            padding: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .pilot-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--cyan-500), var(--purple-500));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .pilot-info {
            flex: 1;
        }

        .pilot-name {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .pilot-location {
            font-size: 0.7rem;
            color: var(--text-tertiary);
        }

        .pilot-status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--green-500);
            box-shadow: 0 0 8px var(--green-500);
        }

        .pilot-status-dot.busy {
            background: var(--yellow-500);
            box-shadow: 0 0 8px var(--yellow-500);
        }

        .pilot-status-dot.offline {
            background: var(--text-tertiary);
            box-shadow: none;
        }

        /* Bottom Ticker */
        .bottom-ticker {
            grid-column: 1 / -1;
            height: 44px;
            background: rgba(0, 0, 0, 0.4);
            border-top: 1px solid var(--border-medium);
            display: flex;
            align-items: center;
            overflow: hidden;
            position: relative;
        }

        .ticker-label {
            background: var(--cyan-500);
            color: var(--bg-primary);
            padding: 0 16px;
            height: 100%;
            display: flex;
            align-items: center;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            flex-shrink: 0;
            z-index: 1;
        }

        .ticker-content {
            flex: 1;
            overflow: hidden;
            position: relative;
        }

        .ticker-scroll {
            display: flex;
            animation: ticker-scroll 60s linear infinite;
            white-space: nowrap;
        }

        @keyframes ticker-scroll {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        .ticker-item {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 0 32px;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .ticker-item .label {
            color: var(--text-tertiary);
            font-weight: 500;
        }

        .ticker-item .value {
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
        }

        .ticker-item .value.positive {
            color: var(--green-500);
        }

        .ticker-item .value.negative {
            color: var(--red-500);
        }

        .ticker-divider {
            color: var(--border-medium);
            padding: 0 8px;
        }

        /* No Missions Empty State */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--text-tertiary);
            text-align: center;
            padding: 20px;
        }

        .empty-state svg {
            width: 48px;
            height: 48px;
            stroke: var(--border-medium);
            margin-bottom: 12px;
        }

        .empty-state p {
            font-size: 0.85rem;
        }

        /* CAT Mode Overlay */
        .cat-mode-overlay {
            display: none;
            position: fixed;
            top: 56px;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(239, 68, 68, 0.03);
            pointer-events: none;
            z-index: 50;
            border: 3px solid var(--red-500);
            animation: cat-border-pulse 2s infinite;
        }

        .cat-mode-overlay.active {
            display: block;
        }

        @keyframes cat-border-pulse {
            0%, 100% { border-color: rgba(239, 68, 68, 0.5); }
            50% { border-color: rgba(239, 68, 68, 1); }
        }

        .cat-mode-banner {
            display: none;
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            background: var(--red-500);
            color: white;
            padding: 8px 32px;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            border-radius: 0 0 8px 8px;
            animation: cat-banner-pulse 1.5s infinite;
            pointer-events: auto;
        }

        .cat-mode-banner.active {
            display: block;
        }

        @keyframes cat-banner-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Loading shimmer */
        .loading-shimmer {
            background: linear-gradient(90deg, 
                var(--bg-card) 25%, 
                rgba(255, 255, 255, 0.05) 50%, 
                var(--bg-card) 75%
            );
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
    </style>
</head>
<body>
    <!-- Header Bar -->
    <header class="header-bar">
        <div class="header-left">
            <a href="index.html">
                <img src="aerosure_io_logo.png" alt="AeroSure" class="logo-img">
            </a>
            <div class="header-title">
                <h1>COMMAND CENTER</h1>
                <span class="badge">Beta</span>
            </div>
        </div>
        
        <div class="header-center">
            <div class="status-indicator">
                <span class="status-dot"></span>
                <span>All Systems Operational</span>
            </div>
            <div class="status-indicator">
                <span class="status-dot warning" id="weather-status"></span>
                <span id="active-alerts-count">Loading alerts...</span>
            </div>
        </div>
        
        <div class="header-right">
            <a href="airspace-ops.html" class="nav-link">Airspace Ops</a>
            <a href="storm-tracker.html" class="nav-link">Storm Tracker</a>
            <div class="live-clock">
                <span class="date" id="clock-date"></span>
                <span id="clock-time"></span>
            </div>
            <button class="cat-mode-btn" id="cat-mode-toggle">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                </svg>
                CAT Mode
            </button>
        </div>
    </header>

    <!-- CAT Mode Overlay -->
    <div class="cat-mode-overlay" id="cat-overlay"></div>
    <div class="cat-mode-banner" id="cat-banner">⚡ CATASTROPHE RESPONSE ACTIVE ⚡</div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Left: Threat Map -->
        <div class="map-panel">
            <div id="threat-map"></div>
            
            <div class="map-controls">
                <div class="map-control-group">
                    <h4>Threat Layers</h4>
                    <label class="layer-toggle">
                        <input type="checkbox" id="layer-warnings" checked>
                        <span class="toggle-switch"></span>
                        <span>NWS Warnings</span>
                    </label>
                    <label class="layer-toggle">
                        <input type="checkbox" id="layer-radar" checked>
                        <span class="toggle-switch"></span>
                        <span>Radar</span>
                    </label>
                    <label class="layer-toggle">
                        <input type="checkbox" id="layer-tfr">
                        <span class="toggle-switch"></span>
                        <span>TFRs</span>
                    </label>
                    <label class="layer-toggle">
                        <input type="checkbox" id="layer-hurricanes" checked>
                        <span class="toggle-switch"></span>
                        <span>Tropical</span>
                    </label>
                </div>
            </div>

            <div class="map-legend">
                <div class="legend-title">Warning Types</div>
                <div class="legend-items">
                    <div class="legend-item">
                        <span class="legend-color" style="background: #ff0000;"></span>
                        Tornado
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #ff9900;"></span>
                        Severe T-Storm
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #00ff00;"></span>
                        Flash Flood
                    </div>
                    <div class="legend-item">
                        <span class="legend-color" style="background: #ff00ff;"></span>
                        Hurricane
                    </div>
                </div>
            </div>
        </div>

        <!-- Right: Info Panels -->
        <div class="right-panel">
            <!-- Active Alerts -->
            <div class="panel-section alerts">
                <div class="panel-header">
                    <h3>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                            <line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/>
                        </svg>
                        Active Alerts
                    </h3>
                    <span class="count critical" id="alert-count">--</span>
                </div>
                <div class="panel-content" id="alerts-container">
                    <div class="loading-shimmer" style="height: 80px; border-radius: 8px; margin-bottom: 10px;"></div>
                    <div class="loading-shimmer" style="height: 80px; border-radius: 8px; margin-bottom: 10px;"></div>
                    <div class="loading-shimmer" style="height: 80px; border-radius: 8px;"></div>
                </div>
            </div>

            <!-- Mission Queue -->
            <div class="panel-section missions">
                <div class="panel-header">
                    <h3>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>
                        </svg>
                        Mission Queue
                    </h3>
                    <span class="count" id="mission-count">0</span>
                </div>
                <div class="panel-content" id="missions-container">
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                        <p>No active missions</p>
                    </div>
                </div>
            </div>

            <!-- Pilot Network -->
            <div class="panel-section pilots">
                <div class="panel-header">
                    <h3>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                        </svg>
                        Pilot Network
                    </h3>
                    <span class="count" id="pilot-count">1</span>
                </div>
                <div class="panel-content">
                    <div class="pilot-grid">
                        <div class="pilot-card">
                            <div class="pilot-avatar">DJ</div>
                            <div class="pilot-info">
                                <div class="pilot-name">Dustin Jones</div>
                                <div class="pilot-location">Richmond, VA</div>
                            </div>
                            <span class="pilot-status-dot"></span>
                        </div>
                        <div class="pilot-card" style="opacity: 0.5;">
                            <div class="pilot-avatar" style="background: var(--border-medium);">+</div>
                            <div class="pilot-info">
                                <div class="pilot-name" style="color: var(--text-tertiary);">Recruiting</div>
                                <div class="pilot-location">Mid-Atlantic</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Ticker -->
        <div class="bottom-ticker">
            <div class="ticker-label">LIVE FEED</div>
            <div class="ticker-content">
                <div class="ticker-scroll" id="ticker-scroll">
                    <!-- Populated by JS -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Map
        const map = new maplibregl.Map({
            container: 'threat-map',
            style: {
                version: 8,
                sources: {
                    'carto-dark': {
                        type: 'raster',
                        tiles: [
                            'https://a.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}@2x.png',
                            'https://b.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}@2x.png',
                            'https://c.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}@2x.png'
                        ],
                        tileSize: 256,
                        attribution: '© CartoDB © OpenStreetMap'
                    }
                },
                layers: [{
                    id: 'carto-dark-layer',
                    type: 'raster',
                    source: 'carto-dark',
                    minzoom: 0,
                    maxzoom: 19
                }]
            },
            center: [-98, 39],
            zoom: 4
        });

        map.addControl(new maplibregl.NavigationControl(), 'bottom-right');

        // Add radar layer when map loads
        map.on('load', () => {
            // NWS Radar
            map.addSource('radar', {
                type: 'raster',
                tiles: ['https://mesonet.agron.iastate.edu/cache/tile.py/1.0.0/nexrad-n0q-900913/{z}/{x}/{y}.png'],
                tileSize: 256
            });
            map.addLayer({
                id: 'radar-layer',
                type: 'raster',
                source: 'radar',
                paint: { 'raster-opacity': 0.7 }
            });

            // Load NWS warnings
            loadNWSWarnings();
        });

        // Layer toggle handlers
        document.getElementById('layer-radar').addEventListener('change', (e) => {
            map.setLayoutProperty('radar-layer', 'visibility', e.target.checked ? 'visible' : 'none');
        });

        // Load NWS Warnings
        async function loadNWSWarnings() {
            try {
                const response = await fetch('https://api.weather.gov/alerts/active?status=actual&message_type=alert');
                const data = await response.json();
                
                const severeAlerts = data.features.filter(f => 
                    ['Tornado Warning', 'Severe Thunderstorm Warning', 'Flash Flood Warning', 
                     'Hurricane Warning', 'Tropical Storm Warning', 'Tornado Watch', 
                     'Severe Thunderstorm Watch', 'Hurricane Watch'].includes(f.properties.event)
                );
                
                // Update alert count
                document.getElementById('alert-count').textContent = severeAlerts.length;
                document.getElementById('active-alerts-count').textContent = `${severeAlerts.length} Active Warnings`;
                
                // Update status dot
                const statusDot = document.getElementById('weather-status');
                if (severeAlerts.some(a => a.properties.event.includes('Tornado Warning') || a.properties.event.includes('Hurricane Warning'))) {
                    statusDot.className = 'status-dot critical';
                } else if (severeAlerts.length > 0) {
                    statusDot.className = 'status-dot warning';
                } else {
                    statusDot.className = 'status-dot';
                }

                // Add warnings to map
                const warningsGeoJSON = {
                    type: 'FeatureCollection',
                    features: severeAlerts.filter(f => f.geometry).slice(0, 100)
                };

                if (map.getSource('warnings')) {
                    map.getSource('warnings').setData(warningsGeoJSON);
                } else {
                    map.addSource('warnings', { type: 'geojson', data: warningsGeoJSON });
                    map.addLayer({
                        id: 'warnings-fill',
                        type: 'fill',
                        source: 'warnings',
                        paint: {
                            'fill-color': [
                                'match', ['get', 'event'],
                                'Tornado Warning', '#ff0000',
                                'Severe Thunderstorm Warning', '#ff9900',
                                'Flash Flood Warning', '#00ff00',
                                'Hurricane Warning', '#ff00ff',
                                'Tropical Storm Warning', '#ff66ff',
                                'Tornado Watch', '#ffff00',
                                'Severe Thunderstorm Watch', '#ffcc00',
                                'Hurricane Watch', '#ff99ff',
                                '#888888'
                            ],
                            'fill-opacity': 0.4
                        }
                    });
                    map.addLayer({
                        id: 'warnings-outline',
                        type: 'line',
                        source: 'warnings',
                        paint: {
                            'line-color': [
                                'match', ['get', 'event'],
                                'Tornado Warning', '#ff0000',
                                'Severe Thunderstorm Warning', '#ff9900',
                                'Flash Flood Warning', '#00ff00',
                                'Hurricane Warning', '#ff00ff',
                                'Tropical Storm Warning', '#ff66ff',
                                'Tornado Watch', '#ffff00',
                                'Severe Thunderstorm Watch', '#ffcc00',
                                'Hurricane Watch', '#ff99ff',
                                '#888888'
                            ],
                            'line-width': 2
                        }
                    });
                }

                // Populate alerts panel
                const alertsContainer = document.getElementById('alerts-container');
                if (severeAlerts.length === 0) {
                    alertsContainer.innerHTML = `
                        <div class="empty-state">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            <p>No severe weather alerts</p>
                        </div>
                    `;
                } else {
                    alertsContainer.innerHTML = severeAlerts.slice(0, 15).map(alert => {
                        const props = alert.properties;
                        const alertClass = props.event.includes('Tornado') || props.event.includes('Hurricane') ? 'critical' : 
                                          props.event.includes('Watch') ? 'watch' : 'warning';
                        const time = new Date(props.onset || props.effective).toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
                        
                        return `
                            <div class="alert-card ${alertClass}">
                                <div class="alert-header">
                                    <span class="alert-type ${alertClass}">${props.event}</span>
                                    <span class="alert-time">${time}</span>
                                </div>
                                <div class="alert-title">${props.headline ? props.headline.substring(0, 60) + '...' : props.event}</div>
                                <div class="alert-location">${props.areaDesc ? props.areaDesc.substring(0, 50) : 'Multiple Areas'}...</div>
                            </div>
                        `;
                    }).join('');
                }
            } catch (err) {
                console.error('Failed to load warnings:', err);
                document.getElementById('alerts-container').innerHTML = `
                    <div class="empty-state">
                        <p>Unable to load alerts</p>
                    </div>
                `;
            }
        }

        // Layer toggle for warnings
        document.getElementById('layer-warnings').addEventListener('change', (e) => {
            const visibility = e.target.checked ? 'visible' : 'none';
            if (map.getLayer('warnings-fill')) map.setLayoutProperty('warnings-fill', 'visibility', visibility);
            if (map.getLayer('warnings-outline')) map.setLayoutProperty('warnings-outline', 'visibility', visibility);
        });

        // Live Clock
        function updateClock() {
            const now = new Date();
            const dateStr = now.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
            const timeStr = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            document.getElementById('clock-date').textContent = dateStr;
            document.getElementById('clock-time').textContent = timeStr;
        }
        updateClock();
        setInterval(updateClock, 1000);

        // CAT Mode Toggle
        const catBtn = document.getElementById('cat-mode-toggle');
        const catOverlay = document.getElementById('cat-overlay');
        const catBanner = document.getElementById('cat-banner');
        let catMode = false;

        catBtn.addEventListener('click', () => {
            catMode = !catMode;
            catBtn.classList.toggle('active', catMode);
            catOverlay.classList.toggle('active', catMode);
            catBanner.classList.toggle('active', catMode);
            
            if (catMode) {
                // Zoom to show CONUS
                map.flyTo({ center: [-95, 37], zoom: 4.5, duration: 1500 });
            }
        });

        // Ticker Content
        function initTicker() {
            const tickerData = [
                { label: 'SPC Outlook', value: 'Day 1: Slight Risk - Central Plains' },
                { label: 'Active Hurricanes', value: 'Monitoring: 0' },
                { label: 'Network Status', value: '1 Pilot Online', positive: true },
                { label: 'Last Mission', value: 'N/A' },
                { label: 'System Uptime', value: '99.9%', positive: true },
                { label: 'NWS Alerts', value: document.getElementById('alert-count').textContent || '--' },
                { label: 'Weather Intel', value: 'Refreshed ' + new Date().toLocaleTimeString() }
            ];

            const tickerHTML = tickerData.map(item => `
                <span class="ticker-item">
                    <span class="label">${item.label}:</span>
                    <span class="value ${item.positive ? 'positive' : ''}">${item.value}</span>
                </span>
                <span class="ticker-divider">|</span>
            `).join('');

            document.getElementById('ticker-scroll').innerHTML = tickerHTML + tickerHTML;
        }
        
        setTimeout(initTicker, 2000);

        // Refresh alerts every 2 minutes
        setInterval(loadNWSWarnings, 120000);
    </script>
</body>
</html>
